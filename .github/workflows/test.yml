name: Test SSH Connection

on:
  workflow_dispatch:

jobs:
  ssh-test:
    runs-on: ubuntu-latest

    steps:
      - name: Mostrar info inicial
        run: |
          echo "üèÅ Iniciando teste SSH"
          echo "Host: ${{ secrets.SSH_HOST }}"
          echo "Usu√°rio: ${{ secrets.SSH_USER }}"

      - name: Salvar chave SSH corretamente
        run: |
          echo "${{ secrets.SSH_PRIVATE_KEY }}" | tr -d '\r' | awk '{print}' ORS='\n' > private_key
          echo "" >> private_key  # for√ßa newline no final
          chmod 600 private_key

      - name: SSH deploy
        uses: appleboy/ssh-action@v0.1.7
        with:
          host: 177.44.248.67
          username: univates
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            echo "‚úÖ Conex√£o via SSH pelo Actions!"
          debug: true  # ativa debug para logs mais detalhados

      - name: Verificar permiss√£o e tipo da chave
        run: |
          ls -l private_key
          file private_key

      - name: Testar conex√£o SSH (verbose)
        run: |
          ssh -vvv -i private_key -o StrictHostKeyChecking=no "${{ secrets.SSH_USER }}@${{ secrets.SSH_HOST }}" "echo '‚úÖ Conex√£o SSH bem-sucedida!'"
