name: Test SSH Connection

on:
  workflow_dispatch: # permite rodar manualmente pela interface do GitHub

jobs:
  ssh-test:
    runs-on: ubuntu-latest

    steps:
      - name: Print debug info
        run: |
          echo "ðŸ Iniciando teste de conexÃ£o SSH"
          echo "UsuÃ¡rio: ${{ secrets.SSH_USER }}"
          echo "Host: ${{ secrets.SSH_HOST }}"

      - name: Descobrir IP pÃºblico do runner
        run: curl https://api.ipify.org

      - name: Setup SSH Key (com quebra de linha)
        run: |
          echo "${{ secrets.SSH_PRIVATE_KEY }}" | tr -d '\r' | awk '{print}' ORS='\n' > private_key
          echo "" >> private_key  # forÃ§a newline no final
          chmod 600 private_key
        shell: bash

      - name: Verificar chave no runner
        run: |
          echo "----- COMEÃ‡O DA CHAVE -----"
          cat private_key
          echo "------ FIM DA CHAVE -------"

      - name: Test SSH connection
        run: |
          ssh -vvv -i private_key -o StrictHostKeyChecking=no "${{ secrets.SSH_USER }}@${{ secrets.SSH_HOST }}" "echo 'âœ… ConexÃ£o SSH bem-sucedida!'"
        shell: bash